services:
  # ===========================================
  # 3x-ui — VLESS Reality management panel
  # ===========================================
  # Web panel: https://<server-ip>:2053
  # VLESS Reality: port 443
  #
  # After first start, follow scripts/02-3xui/post-install.md
  # to configure VLESS Reality inbound and create users.
  #
  x-ui:
    image: ghcr.io/mhsanaei/3x-ui:latest
    container_name: x-ui
    hostname: x-ui
    restart: unless-stopped
    ports:
      - "443:443"       # VLESS Reality
      - "2053:2053"     # Admin panel
      - "2096:2096"     # Subscription (optional, enable in panel settings)
    volumes:
      - ./data/3xui/db:/etc/x-ui
      - ./data/3xui/certs:/root/cert
    environment:
      XRAY_VMESS_AEAD_FORCED: "false"
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  # ===========================================
  # TrustTunnel — HTTP/2 + QUIC tunnel server
  # ===========================================
  # Listens on port 8443 (TCP + UDP)
  #
  # Add users by editing data/trusttunnel/credentials.toml
  # then restart: docker compose restart trusttunnel
  #
  trusttunnel:
    build:
      context: ./trusttunnel
      args:
        ARCH: amd64    # Change to arm64 for ARM servers
    container_name: trusttunnel
    restart: unless-stopped
    ports:
      - "8443:8443/tcp"
      - "8443:8443/udp"
    volumes:
      - ./data/trusttunnel:/etc/trusttunnel
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
